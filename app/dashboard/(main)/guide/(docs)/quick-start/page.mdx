# Quick Start (10 min)

If you are new to Airship, follow this page only.

---

## Goal

Publish iOS + Android OTA updates to `staging`, then manually promote to `production`.

---

## 0) One-Time Setup in Dashboard

1. Create an app in **Apps** (example: `my-app`).
2. Create an API token in **Tokens**.

---

## 1) Dashboard Flow (Recommended)

1. Open **Apps > my-app**.
2. In **Upload Update**:
   - Platform: choose `iOS + Android` (or one platform).
   - Runtime/channel: keep suggested values unless you need custom values.
   - Upload bundle files.
3. Click **Check** (preflight).
4. Keep **Auto promote after upload** OFF (default).
5. Click **Upload**.

Expected:
- Each uploaded platform gets a new update ID.
- Updates are assigned to `staging`.

---

## 2) Promote to Production (Recommended)

1. Open the uploaded update detail page.
2. In **Promote**, choose `staging -> production`.
3. Keep rollout `100%`, then click **Promote**.

---

## 3) Optional: Auto Promote (Advanced)

Use only if your release process is already stable.

1. Turn on **Auto promote after upload**.
2. Set target channel (usually `production`) and rollout.
3. Upload.

Note: default is OFF to reduce accidental production releases.

---

## 4) CLI Flow (Fallback)

```bash
export AIRSHIP_SERVER_URL="http://<your-server>"
export AIRSHIP_TOKEN="airship_xxx..."
export AIRSHIP_ADMIN_SECRET="$AIRSHIP_TOKEN"   # publish script uses this name
export AIRSHIP_APP_KEY="my-app"
export AIRSHIP_RUNTIME_VERSION="1.0.0"

npx expo export --platform ios --output-dir dist

BUNDLE_PATH="$(ls -1 dist/bundles/ios-*.js 2>/dev/null | head -n 1)"
if [ -z "$BUNDLE_PATH" ]; then
  echo "iOS bundle not found under dist/bundles"
  exit 1
fi

./scripts/publish-update.sh \
  --app-key "$AIRSHIP_APP_KEY" \
  --runtime-version "$AIRSHIP_RUNTIME_VERSION" \
  --platform ios \
  --bundle "$BUNDLE_PATH"
```

---

## 5) Validate (No False Positive)

```bash
curl -sS -X POST "$AIRSHIP_SERVER_URL/api/apps/$AIRSHIP_APP_KEY/manifest" \
  -H "expo-platform: ios" \
  -H "expo-runtime-version: $AIRSHIP_RUNTIME_VERSION" \
  -H "expo-channel-name: production" > /tmp/airship-manifest.out

if grep -q 'noUpdateAvailable' /tmp/airship-manifest.out; then
  echo "No update delivered (check channel/runtime/version)"
else
  echo "Update manifest delivered"
fi
```

---

## Common Errors

- `401 Unauthorized`: token missing/invalid/revoked.
- `App not found`: wrong app key.
- `Invalid request body`: check preflight input fields (`platform/runtime/channel/bundle`).
- `no such table: api_tokens`: server migration not applied.

---

## Next

- Daily publish + CI: **OTA Publish Guide**
- Staging verification: **Staging Verification Checklist**
- Production ops: **Production Operations Checklist**
